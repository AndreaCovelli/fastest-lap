#include "src/core/applications/circuit_preprocessor.h"
#include "gtest/gtest.h"

extern bool is_valgrind;

TEST(Circuit_preprocessor_test, catalunya_500)
{
    #ifndef NDEBUG
        GTEST_SKIP();
    #endif

    if ( is_valgrind ) GTEST_SKIP();

    Xml_document coord_left_kml("./database/google_earth/Catalunya_left.kml", true);
    Xml_document coord_right_kml("./database/google_earth/Catalunya_right.kml", true);
    
    Circuit_preprocessor circuit(coord_left_kml, coord_right_kml, 500, true);

    Xml_document solution_saved("./database/catalunya_discrete.xml", true);

    const std::vector<scalar> s     = solution_saved.get_element("circuit/data/arclength").get_value(std::vector<scalar>());
    const std::vector<scalar> x     = solution_saved.get_element("circuit/data/centerline/x").get_value(std::vector<scalar>());
    const std::vector<scalar> y     = solution_saved.get_element("circuit/data/centerline/y").get_value(std::vector<scalar>());
    const std::vector<scalar> theta = solution_saved.get_element("circuit/data/theta").get_value(std::vector<scalar>());
    const std::vector<scalar> kappa = solution_saved.get_element("circuit/data/kappa").get_value(std::vector<scalar>());
    const std::vector<scalar> nl    = solution_saved.get_element("circuit/data/nl").get_value(std::vector<scalar>());
    const std::vector<scalar> nr    = solution_saved.get_element("circuit/data/nr").get_value(std::vector<scalar>());
    const std::vector<scalar> dkappa = solution_saved.get_element("circuit/data/dkappa").get_value(std::vector<scalar>());
    const std::vector<scalar> dnl    = solution_saved.get_element("circuit/data/dnl").get_value(std::vector<scalar>());
    const std::vector<scalar> dnr    = solution_saved.get_element("circuit/data/dnr").get_value(std::vector<scalar>());

    EXPECT_EQ(circuit.n_points,500);
    EXPECT_EQ(circuit.r_centerline.size(),500);
    EXPECT_EQ(circuit.theta.size(),500);
    EXPECT_EQ(circuit.kappa.size(),500);
    EXPECT_EQ(circuit.nl.size(),500);
    EXPECT_EQ(circuit.nr.size(),500);
    EXPECT_EQ(circuit.dkappa.size(),500);
    EXPECT_EQ(circuit.dnl.size(),500);
    EXPECT_EQ(circuit.dnr.size(),500);

    // compare centerline
    for (size_t i = 0; i < circuit.n_points; ++i)
    {
        EXPECT_DOUBLE_EQ(circuit.r_centerline[i].x(), x[i]) << " with i = " << i; 
        EXPECT_DOUBLE_EQ(circuit.r_centerline[i].y(), y[i]) << " with i = " << i; 
        EXPECT_DOUBLE_EQ(circuit.theta[i], theta[i]) << " with i = " << i; 
        EXPECT_DOUBLE_EQ(circuit.kappa[i], kappa[i]) << " with i = " << i; 
        EXPECT_DOUBLE_EQ(circuit.nl[i], nl[i]) << " with i = " << i; 
        EXPECT_DOUBLE_EQ(circuit.nr[i], nr[i]) << " with i = " << i; 
        EXPECT_DOUBLE_EQ(circuit.dkappa[i], dkappa[i]) << " with i = " << i; 
        EXPECT_DOUBLE_EQ(circuit.dnl[i], dnl[i]) << " with i = " << i; 
        EXPECT_DOUBLE_EQ(circuit.dnr[i], dnr[i]) << " with i = " << i; 
    }
        
}

TEST(Circuit_preprocessor_test, catalunya_500_delete)
{
    #ifndef NDEBUG
        GTEST_SKIP();
    #endif

    if ( is_valgrind ) GTEST_SKIP();

    std::vector<scalar> lon_left = {2.2631910845289971,       2.2618586820950131,       2.2612800404516520,       2.2611524355206298,       2.2606414102482120,
      2.2599682913866630,       2.2592069557372580,       2.2583669528474131,       2.2582999528183278,       2.2582558344454728,
      2.2582096364620141,       2.2581246407199500,       2.2580498112033069,       2.2579088963665672,       2.2578022881395610,
      2.2571636388386169,       2.2569430510060369,       2.2568936388136800,       2.2568303598418171,       2.2567634241386370,
      2.2566811431529521,       2.2566301546340650,       2.2564975290319240,       2.2563718478008021,       2.2562368614450290,
      2.2561729327511699,       2.2560439027902350,       2.2559308014722230,       2.2558655546745991,       2.2558162545918830,
      2.2557430191166778,       2.2556535499563979,       2.2555997737033069,       2.2555305387919629,       2.2554873035916629,
      2.2554867937411820,       2.2554373267743189,       2.2553811394977070,       2.2553302523785090,       2.2552746070939089,
      2.2552311889324428,       2.2551788682047320,       2.2551218526552508,       2.2550519448005661,       2.2549795259892980,
      2.2547507685414740,       2.2543547475142218,       2.2542273892106990,       2.2540678906160272,       2.2539502180569899,
      2.2538207363213569,       2.2537126405482240,       2.2535582672506389,       2.2534274958383200,       2.2533210285060101,
      2.2531968119999091,       2.2531013790840189,       2.2530150415992982,       2.2529290192242550,       2.2528554117312138,
      2.2527785634294721,       2.2527060510316250,       2.2526194447702230,       2.2525476908562130,       2.2525054514615710,
      2.2524575420447568,       2.2524126272901812,       2.2523787584856199,       2.2523460815544989,       2.2523138691722582,
      2.2522745443636278,       2.2522380220709981,       2.2522008833481411,       2.2521665003426179,       2.2521278664871640,
      2.2521028458307168,       2.2520921812913448,       2.2520829027608209,       2.2520763226963680,       2.2520792260799221,
      2.2520884087278441,       2.2521030393528552,       2.2521025869490008,       2.2521257561019170,       2.2521470650381730,
      2.2521778197148579,       2.2522153406031342,       2.2522764371156030,       2.2523255112132690,       2.2523774828458660,
      2.2524385933620739,       2.2525359925458321,       2.2526143212222172,       2.2526673496525440,       2.2527173449903342,
      2.2530976508784550,       2.2537708468245832,       2.2538421641324620,       2.2539223734247700,       2.2539803275614800,
      2.2540419486698759,       2.2540895800686211,       2.2541539104300989,       2.2542134889929022,       2.2542780994251470,
      2.2543592686324421,       2.2544332349398211,       2.2545259980999539,       2.2546138132055020,       2.2546841598420380,
      2.2547433648491739,       2.2547999125680618,       2.2548505836444970,       2.2548932754538038,       2.2549595173173591,
      2.2550230913326108,       2.2550672899466000,       2.2551147145264032,       2.2551675463602110,       2.2552009759265261,
      2.2552429861044621,       2.2552879894434770,       2.2553238457542779,       2.2553620687029641,       2.2553944109375950,
      2.2554193642827651,       2.2554347868429740,       2.2554455356286751,       2.2554527863856899,       2.2554525792644502,
      2.2554488779440400,       2.2554356211217801,       2.2554151912232672,       2.2553896894007330,       2.2553491936732621,
      2.2553121090150170,       2.2552850059502449,       2.2551943512624879,       2.2549167580196561,       2.2548246515613362,
      2.2547464851747319,       2.2544175292811079,       2.2543125575295759,       2.2541989453837652,       2.2541670534505509,
      2.2541423579261850,       2.2541213804804849,       2.2540995951150928,       2.2540816632228222,       2.2540725773443131,
      2.2540658156759470,       2.2540593526953372,       2.2540594136767371,       2.2540638506659332,       2.2540724981847742,
      2.2540842669080901,       2.2540964765719300,       2.2541138500819198,       2.2541346809108220,       2.2541641150505480,
      2.2542025021231682,       2.2542351400336220,       2.2542684036543998,       2.2542999831642470,       2.2543421531516490,
      2.2543828552676271,       2.2544336661563440,       2.2544950364177359,       2.2545449295191271,       2.2546076921610299,
      2.2546854731621502,       2.2549055851852380,       2.2550801419619910,       2.2560416467757589,       2.2561642688958168,
      2.2562185518114801,       2.2563577942319530,       2.2564625212859619,       2.2566247000098731,       2.2567434509601658,
      2.2568771697085999,       2.2569747075987050,       2.2570508958768709,       2.2571756250987618,       2.2575712321041759,
      2.2576178943442482,       2.2576673786965640,       2.2576933097718510,       2.2577087784888179,       2.2577156487995591,
      2.2577140710406551,       2.2577038223205030,       2.2576898805750050,       2.2576672989958779,       2.2576369975962680,
      2.2576044112743681,       2.2575766290921528,       2.2575442955507690,       2.2575140154607931,       2.2574748622644081,
      2.2574397620185578,       2.2573920731089170,       2.2572498234663319,       2.2571540677108271,       2.2570913372258010,
      2.2569908364241398,       2.2569232217570740,       2.2568703207548961,       2.2568270300751752,       2.2567956139878431,
      2.2567503121866128,       2.2566999980641840,       2.2566694280987449,       2.2564727468420638,       2.2561386381390398,
      2.2560891777761150,       2.2560225739066548,       2.2559661733533680,       2.2559348458540329,       2.2559128810550528,
      2.2559045366825798,       2.2559005600738580,       2.2559026228119579,       2.2559072960081079,       2.2559183785518511,
      2.2559354270668308,       2.2559615714942738,       2.2559904164066720,       2.2560225671867311,       2.2560628660989379,
      2.2560995836052329,       2.2561380036899870,       2.2561773155577480,       2.2562095232265400,       2.2562452048818100,
      2.2562979428765821,       2.2563519815726201,       2.2563889219898252,       2.2564687291286418,       2.2565416218096130,
      2.2566233444675938,       2.2567906249054759,       2.2569564454819662,       2.2573243252893231,       2.2576724193094910,
      2.2578783581641999,       2.2580720715953362,       2.2585473985053079,       2.2591039141338292,       2.2604802976526468,
      2.2616721912537829,       2.2617300364006350,       2.2617566311830921,       2.2617835513859990,       2.2618046009386390,
      2.2618193796678798,       2.2618277181180901,       2.2618319076429372,       2.2618298874075782,       2.2618236570425538,
      2.2618099348268510,       2.2617914576135911,       2.2617686023676948,       2.2617506705487460,       2.2617314455584059,
      2.2617115481491261,       2.2616592756466991,       2.2615256072158751,       2.2607814126012031,       2.2606510559103410,
      2.2605842571895258,       2.2605482812543150,       2.2605100267766298,       2.2604642807634718,       2.2604209594899038,
      2.2603854942274770,       2.2603478330549960,       2.2603157940437919,       2.2602911300963280,       2.2602637169166222,
      2.2602318588712800,       2.2601750774476170,       2.2601359581044118,       2.2600666332392039,       2.2600087190925060,
      2.2599526498914440,       2.2598894280412880,       2.2598195055271502,       2.2597681754617920,       2.2597153061813779,
      2.2596482140799430,       2.2595893511562481,       2.2595230368741630,       2.2594489139386131,       2.2593608418305071,
      2.2592916971269839,       2.2591824643910270,       2.2591034319501162,       2.2590335583232508,       2.2589776905822578,
      2.2589254496435829,       2.2588942383515320,       2.2588639711058618,       2.2588392097994969,       2.2588213153680399,
      2.2588120237412719,       2.2588069906581620,       2.2588043031847178,       2.2588054195872491,       2.2588112375413272,
      2.2588205912975572,       2.2588342089146511,       2.2588430128778092,       2.2588636707589549,       2.2588915977426200,
      2.2589218304865688,       2.2589525638568970,       2.2589645978194639,       2.2590118933443399,       2.2590649619773480,
      2.2591470217246461,       2.2596051298666660,       2.2601878654998542,       2.2603478744968659,       2.2604431429256922,
      2.2605236410569529,       2.2605706962160221,       2.2606195150065722,       2.2606754888910001,       2.2607177049871590,
      2.2607642554424690,       2.2607972528986959,       2.2608372387372171,       2.2608751272594958,       2.2609114103143968,
      2.2609731947556799,       2.2610488533484112,       2.2611191117890961,       2.2614121245559460,       2.2614393732351390,
      2.2615650210217342,       2.2616175979342179,       2.2617860998854300,       2.2618418695565512,       2.2618656341307801,
      2.2618924964820031,       2.2619117589323579,       2.2619224440363190,       2.2619325377759840,       2.2619433051659832,
      2.2619565102017281,       2.2619667797524978,       2.2619782699534490,       2.2619916859508220,       2.2620054242982008,
      2.2620200278279872,       2.2620454534513330,       2.2620721097595542,       2.2621278451559719,       2.2622263730054710,
      2.2622534301886050,       2.2622822432476042,       2.2623227690040348,       2.2623556395787170,       2.2623949201559879,
      2.2624331730940450,       2.2624814548270371,       2.2625128656073930,       2.2631791347166370,       2.2632706745124609,
      2.2633523548517531,       2.2634161478290342,       2.2634781468731719,       2.2635278412978281,       2.2635883693299141,
      2.2636328730978650,       2.2636833913638150,       2.2637227914476510,       2.2637438937755561,       2.2637541073252021,
      2.2637438533718561,       2.2637236397756588,       2.2637044399613200,       2.2636690066613658,       2.2636427113059732,
      2.2635938966533131,       2.2633419329812470,       2.2631910845289971};

    std::vector<scalar> lat_left = {41.5722653446339834,      41.5706778559008825,      41.5699897967878726,      41.5698382805311581,      41.5692290764779884,
     41.5684297035795609,      41.5675229214888731,      41.5665247397081075,      41.5664314493110965,      41.5663780724614611,
     41.5663229744811176,      41.5662200060491074,      41.5661306979689869,      41.5659637012391769,      41.5658363698146829,
     41.5650788842417427,      41.5648166111952335,      41.5647666043929505,      41.5647084259313289,      41.5646636245240799,
     41.5646233982268711,      41.5646055850973468,      41.5645783672583775,      41.5645756152257633,      41.5645974303576295,
     41.5646160549405295,      41.5646717351096129,      41.5647263481892608,      41.5647559490153924,      41.5647774749806374,
     41.5648044908068499,      41.5648266705186629,      41.5648339225749694,      41.5648390060640835,      41.5648392503762878,
     41.5648398028271728,      41.5648379324904766,      41.5648327843322321,      41.5648243597814329,      41.5648111095656532,
     41.5647984263222767,      41.5647780257337232,      41.5647515938556111,      41.5647169361682174,      41.5646805181772265,
     41.5645553316738798,      41.5643390211244181,      41.5642774547195870,      41.5642194891404628,      41.5641860845027722,
     41.5641609001638770,      41.5641475597820573,      41.5641381377877082,      41.5641428407078877,      41.5641525768332016,
     41.5641711303781420,      41.5641928405674790,      41.5642168678342827,      41.5642453073223521,      41.5642742288008620,
     41.5643096862347576,      41.5643460540158927,      41.5643983775224726,      41.5644494916736917,      41.5644822262678417,
     41.5645242782893476,      41.5645675181975207,      41.5646035579190070,      41.5646410930946431,      41.5646810037009971,
     41.5647362613109834,      41.5647920309688885,      41.5648560954098230,      41.5649272232779765,      41.5650266865001612,
     41.5651150147423678,      41.5651697744659430,      41.5652332335341796,      41.5653345884209031,      41.5654720437656025,
     41.5655658684070133,      41.5656593672934918,      41.5656594470161380,      41.5657641509307894,      41.5658441410748125,
     41.5659335305932132,      41.5660282220096917,      41.5661598840244935,      41.5662495547456672,      41.5663323022800597,
     41.5664182449897410,      41.5665424193092718,      41.5666421584898131,      41.5667129877285504,      41.5667728301929031,
     41.5672259975014313,      41.5680264910931498,      41.5681107221156623,      41.5681935141988319,      41.5682606526579690,
     41.5683169990377976,      41.5683536339735227,      41.5683920512539871,      41.5684201929940471,      41.5684438267611469,
     41.5684650257979413,      41.5684781724090300,      41.5684878474105233,      41.5684886946042198,      41.5684842888638997,
     41.5684746669687826,      41.5684623449183377,      41.5684472277547101,      41.5684323342494935,      41.5684052632372669,
     41.5683729127542065,      41.5683468477546825,      41.5683152558225970,      41.5682761221756607,      41.5682483350439611,
     41.5682075373598821,      41.5681580676130267,      41.5681109163160372,      41.5680517253824888,      41.5679857322712607,
     41.5679171283889985,      41.5678542881861190,      41.5677828919138932,      41.5677057643674033,      41.5676523342101518,
     41.5675829415183813,      41.5675065005984834,      41.5674320726793383,      41.5673584753632284,      41.5672648192142304,
     41.5671926829918732,      41.5671498332358880,      41.5670373367949821,      41.5667074753051509,      41.5666134439530026,
     41.5665216236688266,      41.5661315192120000,      41.5660049787948580,      41.5658728210731070,      41.5658356273815173,
     41.5658036862699731,      41.5657760237537204,      41.5657459073550299,      41.5657164117112714,      41.5656962245868087,
     41.5656752684180972,      41.5656427187958997,      41.5656165431541780,      41.5655834542603202,      41.5655519687869699,
     41.5655287032838174,      41.5655087679751674,      41.5654868251405389,      41.5654649992783334,      41.5654429233301386,
     41.5654189688020423,      41.5654025481983709,      41.5653892573413728,      41.5653807072399104,      41.5653731019864168,
     41.5653697497814179,      41.5653694632900610,      41.5653760497442875,      41.5653891542266791,      41.5654019581774605,
     41.5654278169990832,      41.5655009179394881,      41.5655592386123089,      41.5658811433410165,      41.5659312158982388,
     41.5659542977961820,      41.5660193170168526,      41.5660729766787611,      41.5661710899257386,      41.5662548116716977,
     41.5663617724977712,      41.5664501578403716,      41.5665257495381368,      41.5666681848111281,      41.5671269736567623,
     41.5671954023286006,      41.5672601578174081,      41.5673039276513379,      41.5673499984881190,      41.5673896254341813,
     41.5674296738974576,      41.5674716697842115,      41.5675081507895285,      41.5675448930755493,      41.5675819827648496,
     41.5676116078753068,      41.5676310302954377,      41.5676507144345067,      41.5676656816415075,      41.5676879373686674,
     41.5677082066315222,      41.5677296702397072,      41.5677943544029986,      41.5678454626014400,      41.5678855062337576,
     41.5679647215180310,      41.5680300688259905,      41.5680910216545598,      41.5681542195272300,      41.5682059863205779,
     41.5682841407633319,      41.5683572193020865,      41.5684132324293074,      41.5687624583238886,      41.5693529859236577,
     41.5694585267874430,      41.5695718588965235,      41.5696659945877798,      41.5697422324256820,      41.5698201465689579,
     41.5698735282527565,      41.5699292407424679,      41.5699921363031493,      41.5700448783540608,      41.5701025480033834,
     41.5701627955192308,      41.5702289748783826,      41.5702842630170935,      41.5703361449816668,      41.5703901808593770,
     41.5704330954889016,      41.5704739170826372,      41.5705104718621286,      41.5705380323422418,      41.5705650872468979,
     41.5706024023094116,      41.5706401589770209,      41.5706662383724819,      41.5707070738706790,      41.5707400613074967,
     41.5707727563825671,      41.5708376652891403,      41.5709011207055710,      41.5710437044663266,      41.5711772020942192,
     41.5712561658735922,      41.5713206590554734,      41.5715015868056597,      41.5717129562642072,      41.5722393912048531,
     41.5727296990903170,      41.5727539988968928,      41.5727700878379522,      41.5727880084392822,      41.5728057899639722,
     41.5728257928656504,      41.5728449291657327,      41.5728675793507279,      41.5728881683358225,      41.5729050956653978,
     41.5729254575408831,      41.5729439713650777,      41.5729576940804435,      41.5729664223683812,      41.5729713914870729,
     41.5729772195699567,      41.5729915604910332,      41.5730135046883120,      41.5731384609057102,      41.5731552029794216,
     41.5731652965684830,      41.5731669552491283,      41.5731669789538287,      41.5731614001616592,      41.5731516805412014,
     41.5731398906858516,      41.5731230855609297,      41.5731044480006204,      41.5730886641372521,      41.5730711503727122,
     41.5730516091669315,      41.5730204529389482,      41.5729981795901722,      41.5729558885791377,      41.5729229536781375,
     41.5728958183089574,      41.5728695306894096,      41.5728476208385587,      41.5728356239397172,      41.5728260343326212,
     41.5728186065978704,      41.5728166183102630,      41.5728175342481876,      41.5728228749192610,      41.5728372231775296,
     41.5728535971702584,      41.5728930253378834,      41.5729324640907123,      41.5729774895538711,      41.5730223178818008,
     41.5730755320270475,      41.5731160149829222,      41.5731625522764574,      41.5732139758768682,      41.5732649866532995,
     41.5733049011696707,      41.5733374657162074,      41.5733832129027192,      41.5734267241357074,      41.5734668261292626,
     41.5735087812020723,      41.5735474499468580,      41.5735682737364201,      41.5736100026370607,      41.5736555700458084,
     41.5736951354675170,      41.5737349955075999,      41.5737493368364923,      41.5737862774210427,      41.5738212361698132,
     41.5738733277317394,      41.5741558628147203,      41.5745166436182529,      41.5746050498382971,      41.5746613466547075,
     41.5746998962340584,      41.5747146243315981,      41.5747243398965125,      41.5747276898340701,      41.5747241053078369,
     41.5747127982463027,      41.5746985682417289,      41.5746808674497927,      41.5746667776229373,      41.5746478527371579,
     41.5746130177642499,      41.5745717924669123,      41.5745315979916370,      41.5743661653428234,      41.5743497819399295,
     41.5742787668016476,      41.5742382934575687,      41.5741440088572034,      41.5741127470053016,      41.5741039818770588,
     41.5740910067909013,      41.5740806872645692,      41.5740761507176089,      41.5740733184924167,      41.5740727138573618,
     41.5740733257555704,      41.5740769573550182,      41.5740820689971429,      41.5740918904892425,      41.5741027501739282,
     41.5741132907045525,      41.5741269413384273,      41.5741453104606578,      41.5741903349221573,      41.5742695205020212,
     41.5742890665461999,      41.5743050764677733,      41.5743134494600497,      41.5743128187899913,      41.5743096784733979,
     41.5743046467917878,      41.5742816834971975,      41.5742668682268075,      41.5739495459549033,      41.5738956156638721,
     41.5738445292236065,      41.5738024259553214,      41.5737511534502531,      41.5737041551588931,      41.5736352350058027,
     41.5735726052037933,      41.5734849835663525,      41.5733924285416094,      41.5733071843461275,      41.5731933571830226,
     41.5730689356293723,      41.5729840173698690,      41.5729290221757779,      41.5728478793188003,      41.5727933148180071,
     41.5727276817902265,      41.5724295276139628,      41.5722653446339834};

    std::vector<scalar> lon_right = {2.2630628832470472,       2.2617600240123492,       2.2602603921673659,       2.2586872226569650,       2.2579945363683569,
      2.2573011356816290,       2.2567864250610641,       2.2567641151119160,       2.2567288955211122,       2.2566976872504441,
      2.2566683308954172,       2.2566315187351571,       2.2566050005327631,       2.2565752526047822,       2.2565454592899670,
      2.2565151581644578,       2.2564747927635960,       2.2564249700649301,       2.2563658032952461,       2.2563304936145672,
      2.2562867198399421,       2.2562637589415790,       2.2562272913928978,       2.2561982764127002,       2.2561678695653802,
      2.2561316285497308,       2.2560791793179140,       2.2560056689493009,       2.2559618995445612,       2.2559285667657840,
      2.2558988643233380,       2.2558615886468329,       2.2558315713674100,       2.2557936043149680,       2.2557431923909528,
      2.2556840259509259,       2.2556401139111220,       2.2555933709545162,       2.2555123949575080,       2.2554457548748759,
      2.2553800653734579,       2.2553145389573852,       2.2552411290041090,       2.2551916798775551,       2.2551419648944848,
      2.2550869160084348,       2.2550308142710001,       2.2550016741258432,       2.2549533718897918,       2.2548228497613660,
      2.2546048369039799,       2.2544181184850132,       2.2543330129600858,       2.2542932098045738,       2.2542082448686069,
      2.2541610056831041,       2.2541130841019208,       2.2540722125887069,       2.2540362494732809,       2.2539962406285641,
      2.2539636843750710,       2.2539049420096591,       2.2538585092287788,       2.2538163851637831,       2.2537857630549540,
      2.2537522375631109,       2.2537165450127561,       2.2536495709719029,       2.2536050584186600,       2.2535665113581960,
      2.2535278361852118,       2.2534990908867099,       2.2534773724208450,       2.2534421182133109,       2.2534183488631632,
      2.2533886576053508,       2.2533215381661238,       2.2532730862841182,       2.2532420354900622,       2.2531814383117470,
      2.2531169841743788,       2.2530670344827959,       2.2530164406941182,       2.2529529305543901,       2.2529053757171620,
      2.2528749018345251,       2.2528417156460678,       2.2527968365673749,       2.2527585413355489,       2.2527244390344259,
      2.2526914560710849,       2.2526662887623079,       2.2526323302989870,       2.2526003225644442,       2.2525743328480048,
      2.2525540944521061,       2.2525391841517921,       2.2525134173001788,       2.2524906544007339,       2.2524692382255811,
      2.2524489465881898,       2.2524319301415980,       2.2524186110249489,       2.2524092714063100,       2.2523938203657030,
      2.2523689633855488,       2.2523438535011771,       2.2523183168348360,       2.2523008672526368,       2.2522872792537711,
      2.2522744642020109,       2.2522605188519358,       2.2522471942200779,       2.2522388744772441,       2.2522316410218690,
      2.2522276763420850,       2.2522240961095541,       2.2522220630659011,       2.2522228220103280,       2.2522259856158060,
      2.2522320674829150,       2.2522411776797520,       2.2522569403217241,       2.2522772854586992,       2.2522936535756410,
      2.2523148331330090,       2.2523508835532779,       2.2523846929358520,       2.2524397968777610,       2.2525089232757671,
      2.2525936516796201,       2.2526961153485292,       2.2528816321783069,       2.2539102279290808,       2.2539800392174509,
      2.2540232382961261,       2.2540678026924388,       2.2541064095954328,       2.2541442852015452,       2.2541932348957832,
      2.2542474408567230,       2.2542957122772629,       2.2543475967341942,       2.2543969025448281,       2.2544308072593640,
      2.2544693949558430,       2.2545015341949530,       2.2545426072230912,       2.2545810283435959,       2.2546267857408280,
      2.2546651181167610,       2.2546987106847278,       2.2547314144418911,       2.2547648955760158,       2.2548251839345208,
      2.2549006273098482,       2.2549537739842300,       2.2550113848927928,       2.2550520600988770,       2.2550947012147748,
      2.2551242862330700,       2.2551617301757760,       2.2551834159835860,       2.2552019232633751,       2.2552183305367750,
      2.2552364439948080,       2.2552517740217959,       2.2552688497313018,       2.2552808988811202,       2.2552863566610082,
      2.2552948070875471,       2.2553026134244640,       2.2553054473086709,       2.2553048169207290,       2.2552938987136510,
      2.2552743998328211,       2.2552535167750780,       2.2552272697172500,       2.2552019146778219,       2.2551722027120551,
      2.2551416414040100,       2.2550943924574751,       2.2550558149646549,       2.2550309406710700,       2.2548807331809839,
      2.2547330168106878,       2.2546197048506729,       2.2544905313817121,       2.2543167959983319,       2.2540130784832151,
      2.2539480013047091,       2.2539144302753522,       2.2539121142580139,       2.2539349479398001,       2.2539583899935778,
      2.2540012443318762,       2.2540341328273632,       2.2540753618434839,       2.2541227624126940,       2.2541912775306732,
      2.2542499767432429,       2.2543107798854050,       2.2543978577959471,       2.2544916301324420,       2.2546041814063829,
      2.2547749537440538,       2.2555200859895201,       2.2556579875944549,       2.2560175479241051,       2.2562659865218988,
      2.2564416071077331,       2.2565936641017492,       2.2567644181143791,       2.2569294387201788,       2.2571590886076649,
      2.2573070985329409,       2.2574039844522691,       2.2575433794164601,       2.2577335257957820,       2.2578252807528338,
      2.2578553542692510,       2.2578658600296730,       2.2578558741837429,       2.2578293435643420,       2.2577897952829522,
      2.2577249205967291,       2.2576813403978191,       2.2575669433755441,       2.2574399947766310,       2.2573299742832349,
      2.2572635624868731,       2.2572063660309221,       2.2571725280506638,       2.2571455751247331,       2.2570974275324600,
      2.2570534437393319,       2.2570146391214130,       2.2569668725534719,       2.2569287087888230,       2.2568457173231642,
      2.2567435123361901,       2.2565371446285480,       2.2562676486625040,       2.2561872973444652,       2.2561396269405609,
      2.2561009089768662,       2.2560752606024610,       2.2560608209301640,       2.2560530662305012,       2.2560530029056962,
      2.2560618499159601,       2.2560746344923581,       2.2561020055609089,       2.2561013279058568,       2.2561359370166740,
      2.2561765588504912,       2.2562329809707271,       2.2562943658182122,       2.2563361947157778,       2.2564139611033469,
      2.2565034873187080,       2.2565731958556108,       2.2566767619014110,       2.2590639103342962,       2.2593385621425321,
      2.2604537851556290,       2.2608108399062949,       2.2612752278348469,       2.2616434262089569,       2.2618383180907502,
      2.2619394695027562,       2.2620269129725008,       2.2620823390277871,       2.2620807732674848,       2.2620333558743329,
      2.2620001243570549,       2.2619442486376640,       2.2618620166577590,       2.2617707588827218,       2.2616906674764552,
      2.2614701872164260,       2.2613515857813731,       2.2609258957741680,       2.2606950036775459,       2.2606010172273039,
      2.2605074030886629,       2.2604127381456181,       2.2603464202290602,       2.2602959527741251,       2.2602471420445069,
      2.2601649390941798,       2.2600888355414210,       2.2599993378901511,       2.2599609619002852,       2.2599078772197529,
      2.2598657610166879,       2.2598155370070372,       2.2597619709613581,       2.2596917320982119,       2.2596422342303479,
      2.2595511881578472,       2.2594403889092511,       2.2593616911178471,       2.2592790594758978,       2.2592173015016641,
      2.2591536606070100,       2.2590860139633628,       2.2590381544113609,       2.2590041239398011,       2.2589808995223910,
      2.2589636299043159,       2.2589548669394022,       2.2589595939709479,       2.2589864335733090,       2.2590213683023990,
      2.2590610343035018,       2.2591084499340042,       2.2591391872317508,       2.2592074427489099,       2.2593182677932111,
      2.2603382234646729,       2.2603982530729372,       2.2604894367976081,       2.2605251656179099,       2.2605543709933680,
      2.2605941732756980,       2.2606343906387778,       2.2606808630312720,       2.2607237185180922,       2.2607711741254350,
      2.2608202134799131,       2.2608827857997982,       2.2609960140913610,       2.2612415373816201,       2.2614175776751222,
      2.2614623216740681,       2.2615336547561689,       2.2616594556059071,       2.2617528316332969,       2.2617980403639160,
      2.2618269743266621,       2.2618963512773660,       2.2619485635400589,       2.2619919817029039,       2.2620488865541750,
      2.2620957964817179,       2.2621491317645481,       2.2621904663608339,       2.2622372643133670,       2.2622750955097430,
      2.2623086901997920,       2.2623268708672439,       2.2623436802276280,       2.2623683364576448,       2.2623929323070020,
      2.2624217773437620,       2.2624988265743169,       2.2626220524786782,       2.2629758240880249,       2.2630509796988800,
      2.2631201620565422,       2.2631707033263320,       2.2632142963236830,       2.2632823704902671,       2.2633327517144002,
      2.2633759915549878,       2.2634066609790682,       2.2634398385741390,       2.2634756117019390,       2.2635102330890371,
      2.2635415380752000,       2.2635635574390318,       2.2635805789947572,       2.2635902993434831,       2.2635964807221520,
      2.2635968172571319,       2.2635909458334451,       2.2635808659621870,       2.2635653080831419,       2.2635458994248010,
      2.2635206052644952,       2.2634966846117770,       2.2634730154680720,       2.2634540106903001,       2.2634169530640520,
      2.2633608314026938,       2.2632044757882390,       2.2630628832470472};

    std::vector<scalar> lat_right = {41.5723233262294372,      41.5707745197322325,      41.5689921680490002,      41.5671201155515035,      41.5662992959991726,
     41.5654729718304523,      41.5648572145882511,      41.5648318969629287,      41.5648031530264035,      41.5647793328638429,
     41.5647589283986107,      41.5647386721238306,      41.5647268611197873,      41.5647160680538974,      41.5647079308180665,
     41.5647007648703166,      41.5646942941279676,      41.5646905083443627,      41.5646916413280820,      41.5646962097232375,
     41.5647044073189065,      41.5647098159235782,      41.5647211656103934,      41.5647316765329506,      41.5647438899849035,
     41.5647599629220181,      41.5647808921362696,      41.5648174589918824,      41.5648383504351528,      41.5648550000319332,
     41.5648690748080867,      41.5648849414949666,      41.5648966350379325,      41.5649090430938486,      41.5649226446741622,
     41.5649350797139476,      41.5649447481630503,      41.5649504480750167,      41.5649549897515911,      41.5649539452149526,
     41.5649486076739265,      41.5649391283443634,      41.5649232898042271,      41.5649096265272107,      41.5648915372550078,
     41.5648678746864206,      41.5648406207817729,      41.5648257815558466,      41.5648002197296265,      41.5647287851404599,
     41.5646080226686720,      41.5645081060456931,      41.5644628176852891,      41.5644422048333766,      41.5643987291320727,
     41.5643765096357427,      41.5643572025457431,      41.5643418504975273,      41.5643293759220711,      41.5643160128356328,
     41.5643069989945317,      41.5642915565665589,      41.5642813987777018,      41.5642734681274817,      41.5642686788202269,
     41.5642636726918724,      41.5642595559264478,      41.5642535188478774,      41.5642510859083529,      41.5642497206979584,
     41.5642494366276196,      41.5642497857444226,      41.5642502115211769,      41.5642514958814715,      41.5642533954597866,
     41.5642559507768823,      41.5642632125716673,      41.5642702828007131,      41.5642756055274276,      41.5642879111840671,
     41.5643030476909416,      41.5643179889155476,      41.5643349833292675,      41.5643582252797188,      41.5643781273518869,
     41.5643920562092504,      41.5644083868607126,      41.5644318571650970,      41.5644531907887611,      41.5644749603565984,
     41.5644969764264971,      41.5645145313783573,      41.5645400360540478,      41.5645664319999781,      41.5645897518410621,
     41.5646085555319971,      41.5646241438594686,      41.5646500055655181,      41.5646755231845830,      41.5647020491201928,
     41.5647270179833299,      41.5647491273079979,      41.5647668114233184,      41.5647800130547225,      41.5648029225253097,
     41.5648440842447329,      41.5648859274566576,      41.5649339488352467,      41.5649714646928174,      41.5650063744243994,
     41.5650432592345567,      41.5650834415504491,      41.5651306479734615,      41.5651717241045020,      41.5652085125815418,
     41.5652403411296234,      41.5652803973450702,      41.5653533796598609,      41.5654108945041401,      41.5654626820011970,
     41.5655315368259508,      41.5655998607443635,      41.5656842715379113,      41.5657696333084274,      41.5658241859659014,
     41.5658848965151506,      41.5659725640896269,      41.5660528405725032,      41.5661593318570084,      41.5662789371874979,
     41.5663977730082124,      41.5665261253377025,      41.5667435930112177,      41.5679741273762318,      41.5680597413238786,
     41.5681152377591303,      41.5681618128533827,      41.5682027774439931,      41.5682375152740775,      41.5682727727699515,
     41.5683041382260896,      41.5683266345701270,      41.5683452202870001,      41.5683593172001622,      41.5683666460265826,
     41.5683725272188269,      41.5683760566342713,      41.5683789927510787,      41.5683799128123894,      41.5683775669650686,
     41.5683742346649581,      41.5683691626374525,      41.5683626122801968,      41.5683546409933911,      41.5683355523384606,
     41.5683043765789293,      41.5682756370137980,      41.5682385446492972,      41.5682085698729082,      41.5681729362040215,
     41.5681432449352002,      41.5681030532525000,      41.5680739587964325,      41.5680487700960200,      41.5680234541054503,
     41.5679908557482634,      41.5679574651809389,      41.5679108883199078,      41.5678725680244199,      41.5678464412720032,
     41.5678105940440119,      41.5677559458500596,      41.5676997254861575,      41.5676351926577965,      41.5675486720952776,
     41.5674727140515401,      41.5674199562386377,      41.5673589487885735,      41.5673093715003219,      41.5672594339990269,
     41.5672140689679566,      41.5671493402757974,      41.5670997454385187,      41.5670643035762168,      41.5668864547104278,
     41.5667123136856489,      41.5665948968585397,      41.5664403622568628,      41.5662337522960996,      41.5658691533959086,
     41.5657776441229032,      41.5656822935527828,      41.5655833771092702,      41.5655081178751615,      41.5654601321541222,
     41.5654087254110394,      41.5653808015192325,      41.5653497601792523,      41.5653215768663102,      41.5652919014514168,
     41.5652736231493094,      41.5652616862397011,      41.5652552451189266,      41.5652591642833826,      41.5652767504930125,
     41.5653335861181219,      41.5655818989338570,      41.5656289080314068,      41.5657546028872886,      41.5658480082826713,
     41.5659300392734323,      41.5660157070731984,      41.5661207676276732,      41.5662437786001178,      41.5664569311418433,
     41.5666263691703293,      41.5667383312821883,      41.5668942446606735,      41.5671181431435173,      41.5672507124837622,
     41.5673210062487897,      41.5674046143599014,      41.5674805944846497,      41.5675506394669512,      41.5676146630974870,
     41.5676812207654720,      41.5677157651432978,      41.5677813039431072,      41.5678416784724831,      41.5678917510523718,
     41.5679267123171527,      41.5679627362207071,      41.5679862686275428,      41.5680080205788869,      41.5680490105634632,
     41.5680905830592522,      41.5681319416463211,      41.5681959880336578,      41.5682540879936724,      41.5683946294659208,
     41.5685725827374810,      41.5689362679137488,      41.5694131663329571,      41.5695606643178976,      41.5696442009416529,
     41.5697249725454583,      41.5697946676688019,      41.5698574585029874,      41.5699258476407181,      41.5699965865015173,
     41.5700593062785018,      41.5701095108227534,      41.5701837643756704,      41.5701838467695381,      41.5702534869173377,
     41.5703133761606978,      41.5703797041905716,      41.5704426001841227,      41.5704830797842533,      41.5705348293087198,
     41.5705851397623576,      41.5706222939529297,      41.5706657634178711,      41.5715817269217425,      41.5716780040993683,
     41.5721018447221766,      41.5722418563554825,      41.5724220416372674,      41.5725622012806610,      41.5726398338271466,
     41.5726849296816283,      41.5727415593433065,      41.5728131077073115,      41.5729064522092173,      41.5729774377519021,
     41.5730237406800214,      41.5730555425123427,      41.5730774712491424,      41.5730928275332374,      41.5731043765525570,
     41.5731402345899994,      41.5731603102021410,      41.5732269075598921,      41.5732620335690726,      41.5732692910627435,
     41.5732757560664368,      41.5732691245860480,      41.5732532510743695,      41.5732366824295099,      41.5732079922864983,
     41.5731573095786331,      41.5731161392685067,      41.5730613623456833,      41.5730385820010326,      41.5730117949298403,
     41.5729913623894376,      41.5729694634201792,      41.5729546798975775,      41.5729402724472408,      41.5729324386154815,
     41.5729292322593125,      41.5729394927557365,      41.5729555383331828,      41.5729817286811922,      41.5730104635358302,
     41.5730477761881474,      41.5731028996044500,      41.5731551905642434,      41.5732068588172083,      41.5732578865401976,
     41.5733067396863376,      41.5733628798907375,      41.5734473361176526,      41.5735348263147131,      41.5735969434735608,
     41.5736447143602277,      41.5736919704502483,      41.5737184216702076,      41.5737617091414720,      41.5738320406986972,
     41.5744621228193765,      41.5744977421372468,      41.5745458213873604,      41.5745640644558065,      41.5745773784346397,
     41.5745886069392583,      41.5745932032827596,      41.5745927518440084,      41.5745855454928304,      41.5745679601343525,
     41.5745413471904826,      41.5745110741395223,      41.5744489286410612,      41.5743117305705994,      41.5742120968157707,
     41.5741757796624327,      41.5741334943691925,      41.5740634513381977,      41.5740104472591980,      41.5739864609227112,
     41.5739752092467327,      41.5739592164552221,      41.5739539466136634,      41.5739580368877384,      41.5739735426159029,
     41.5740023952402566,      41.5740455926893375,      41.5740783495640827,      41.5741125594680270,      41.5741407233662486,
     41.5741641280501426,      41.5741773883724619,      41.5741887022146202,      41.5741905201752502,      41.5741820922066978,
     41.5741688871352224,      41.5741347479812831,      41.5740787067539515,      41.5739073250118167,      41.5738708018540066,
     41.5738360077764426,      41.5738101008858578,      41.5737873859677265,      41.5737410818476434,      41.5737039482305590,
     41.5736678058278173,      41.5736347073650094,      41.5735996377886181,      41.5735528056494914,      41.5734986530341217,
     41.5734392949048228,      41.5733877607181270,      41.5733262948616797,      41.5732746448873698,      41.5732140362739315,
     41.5731438988416215,      41.5731043979357224,      41.5730504165233370,      41.5730044755966119,      41.5729502297892424,
     41.5729001994728335,      41.5728624377750080,      41.5728273318296075,      41.5727954123782126,      41.5727454141693187,
     41.5726744252531830,      41.5724907191936168,      41.5723233262294372};

    EXPECT_DOUBLE_EQ(lon_left.front(), lon_left.back());
    EXPECT_DOUBLE_EQ(lat_left.front(), lat_left.back());
    EXPECT_DOUBLE_EQ(lon_right.front(), lon_right.back());
    EXPECT_DOUBLE_EQ(lat_right.front(), lat_right.back());

    std::vector<std::array<scalar,2>> coord_left(lon_left.size()-1);
    for (size_t i = 0; i < lon_left.size()-1; ++i)
        coord_left[i] = std::array<scalar,2>({lon_left[i], lat_left[i]});

    std::vector<std::array<scalar,2>> coord_right(lon_right.size()-1);
    for (size_t i = 0; i < lon_right.size()-1; ++i)
        coord_right[i] = std::array<scalar,2>({lon_right[i], lat_right[i]});

    // Start now in i = 20 to check something
    std::vector<std::array<scalar,2>> coord_left_new;
    std::vector<std::array<scalar,2>> coord_right_new;

    for (size_t i = 5; i < coord_left.size(); ++i)
        coord_left_new.push_back(coord_left[i]);
    for (size_t i = 0; i < 5; ++i)
        coord_left_new.push_back(coord_left[i]);


    for (size_t i = 5; i < coord_right.size(); ++i)
        coord_right_new.push_back(coord_right[i]);
    for (size_t i = 0; i < 5; ++i)
        coord_right_new.push_back(coord_right[i]);
    
    Circuit_preprocessor(coord_left, coord_right, 500, true).xml()->save("catalunya_discrete.xml");
}
